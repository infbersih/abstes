<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Simpan ke Google Sheets</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; }
    .success { color: green; margin-top: 10px; }
    .error { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Test Kirim Data ke Google Sheets</h2>

  <button id="btnSimpan">Simpan Data</button>
  <div id="result"></div>

  <script>
    const webhookURL = "https://script.google.com/macros/s/AKfycbyJYotpum3BLRHk9VNOngElWqKEaBV3r_l3BecuiQE_zuqaA5HPuMvWhyse5OOK5kyJ/exec";

    document.getElementById("btnSimpan").addEventListener("click", () => {
      // contoh data dummy
      const scanParts = ["12345", "Budi", "10A", "08123456789", "08987654321"];
      const kondisi = "Hadir";
      const alasan = "ada keperluan keluarga";
      // Format ke waktu Jakarta
      const now = new Date();
      const offsetMs = 7 * 60 * 60 * 1000; // offset GMT+7
      const jakarta = new Date(now.getTime() + offsetMs - (now.getTimezoneOffset() * 60000));
      const timestamp = jakarta.toISOString().slice(0, 19).replace("T", " ");

      const resultEl = document.getElementById("result");
      resultEl.textContent = "⏳ Mengirim data...";

      fetch(webhookURL, {
        method: "POST",
        body: new URLSearchParams({
          timestamp: timestamp,
          nis: scanParts[0],
          nama: scanParts[1],
          kelas: scanParts[2],
          kondisi: kondisi,
          alasan: alasan,
          hp1: scanParts[3],
          hp2: scanParts[4],
          timestamp: timestamp
        }),
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      })
      .then(res => res.json())
      .then(json => {
        if (json.status === "OK") {
          resultEl.textContent = "✅ " + json.message;
          resultEl.className = "success";
        } else {
          resultEl.textContent = "❌ Gagal: " + json.message;
          resultEl.className = "error";
        }
      })
      .catch(err => {
        resultEl.textContent = "❌ Error koneksi: " + err;
        resultEl.className = "error";
      });
    });
  </script>
</body>
</html>
